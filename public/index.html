<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agreement Generator v6.3 (Pro)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker-bs5.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="generator-container">
    <h1>Agreement Generator v6.3</h1>

    <div class="input-column">
        <fieldset>
            <legend><svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/></svg>Общие данные</legend>
            <div class="form-grid">
                <div class="form-group"><label for="main-contract-number">Номер договора</label><input type="text" id="main-contract-number"></div>
                <div class="form-group">
                    <label for="main-contract-date">Дата договора</label>
                    <div class="date-input-group">
                        <input type="text" class="datepicker-input" id="main-contract-date" placeholder="дд.мм.гггг">
                        <button class="btn small" type="button" onclick="setCurrentDate('main-contract-date')">Сегодня</button>
                    </div>
                </div>
            </div>
            <div class="form-group"><label for="insurance-type">Вид страхования</label><input type="text" id="insurance-type" value="добровольного страхования автомобильного транспорта"></div>
            <div class="form-grid">
                <div class="form-group"><label for="base-document">Основание</label><select id="base-document"><option value="письмо Страхователя">Письмо Страхователя</option><option value="заявление Страхователя">Заявление</option></select></div>
                <div class="form-group"><label for="incoming-doc-number">Вх. номер</label><input type="text" id="incoming-doc-number"></div>
                 <div class="form-group">
                    <label for="incoming-doc-date">Дата вх.</label>
                    <div class="date-input-group">
                        <input type="text" class="datepicker-input" id="incoming-doc-date" placeholder="дд.мм.гггг">
                        <button class="btn small" type="button" onclick="setCurrentDate('incoming-doc-date')">Сегодня</button>
                    </div>
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend><svg fill="currentColor" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>Тип изменения</legend>
            <div class="form-group">
                <div class="toggle-group" id="main-mode-selector">
                    <input type="radio" id="mode-calc-add" name="main-mode" value="calc-add"><label for="mode-calc-add">Добавление ТС</label>
                    <input type="radio" id="mode-calc-increase" name="main-mode" value="calc-increase"><label for="mode-calc-increase">Увеличение СС</label>
                    <input type="radio" id="mode-calc-decrease" name="main-mode" value="calc-decrease"><label for="mode-calc-decrease">Уменьшение СС</label>
                    <input type="radio" id="mode-calc-terminate" name="main-mode" value="calc-terminate"><label for="mode-calc-terminate">Расторжение</label>
                    <input type="radio" id="mode-manual" name="main-mode" value="manual" checked><label for="mode-manual">Ручной ввод</label>
                    <input type="radio" id="mode-info" name="main-mode" value="info"><label for="mode-info">Информационное</label>
                    <span id="ai-status-indicator" style="margin-left: 15px; font-size: 0.9rem; padding: 5px 10px; border-radius: 4px;"></span>
                </div>
            </div>
        </fieldset>

        <div id="calculator-wrapper" class="details-section">
            <fieldset>
                <legend><svg fill="currentColor" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4 14h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2zm-4 8h-2v-2h2v2zm-4 0H7v-2h2v2zm4-4h-2v-2h2v2zm-4 0H7v-2h2v2zm0-4H7V7h2v2zm8 8h-2v-2h2v2z"/></svg>Калькулятор</svg></legend>
                <div id="calc-change-section" class="details-section">
                    <div class="form-grid">
                        <div class="form-group"><label for="calc-start-date">Дата начала полиса</label><div class="date-input-group"><input type="text" class="datepicker-input" id="calc-start-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('calc-start-date')">Сегодня</button></div></div>
                        <div class="form-group"><label for="calc-end-date">Дата окончания полиса</label><div class="date-input-group"><input type="text" class="datepicker-input" id="calc-end-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('calc-end-date')">Сегодня</button></div></div>
                    </div>
                     <div class="form-group"><label for="calc-effective-date" id="calc-effective-date-label">Дата изменения</label><div class="date-input-group"><input type="text" class="datepicker-input" id="calc-effective-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('calc-effective-date')">Сегодня</button></div></div>
                    <div class="form-group"><label for="calc-sum-insured" id="calc-sum-insured-label">Страховая сумма</label><input type="text" class="number-input" id="calc-sum-insured" placeholder="5 000 000"></div>
                    <div class="form-group"><label for="calc-tariff">Тариф (%)</label><input type="number" step="0.01" id="calc-tariff" placeholder="0.5"></div>
                    <button type="button" class="btn" id="calc-action-button" onclick="runCalculation()">Рассчитать</button>
                    <div id="calc-result-change" class="calc-result-display" style="display: none;"></div>
                </div>

                <div id="calc-terminate-section" class="details-section">
                     <div class="form-grid">
                        <div class="form-group"><label for="term-start-date">Дата начала полиса</label><div class="date-input-group"><input type="text" class="datepicker-input" id="term-start-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('term-start-date')">Сегодня</button></div></div>
                        <div class="form-group"><label for="term-end-date">Дата окончания полиса</label><div class="date-input-group"><input type="text" class="datepicker-input" id="term-end-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('term-end-date')">Сегодня</button></div></div>
                    </div>
                    <div class="form-group"><label for="term-effective-date">Дата расторжения</label><div class="date-input-group"><input type="text" class="datepicker-input" id="term-effective-date" placeholder="дд.мм.гггг"><button class="btn small" type="button" onclick="setCurrentDate('term-effective-date')">Сегодня</button></div></div>
                    <div class="form-group"><label for="term-total-premium">Общая уплаченная премия</label><input type="text" class="number-input" id="term-total-premium" placeholder="50 000"></div>
                    <div class="form-group"><label for="term-rvd">РВД (%)</label><input type="number" step="0.01" id="term-rvd" placeholder="20"></div>
                    <button type="button" class="btn" onclick="runCalculation()">Рассчитать возврат</button>
                    <div id="calc-result-terminate" class="calc-result-display" style="display: none;"></div>
                </div>
            </fieldset>
        </div>

        <div id="final-data-wrapper" class="details-section visible">
             <fieldset>
                <legend><svg fill="currentColor" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>Итоговые данные для соглашения</svg></legend>
                <div id="monetary-section" class="details-section visible">
                    <h4>Финансовые изменения</h4>
                    <div class="form-group"><label>Операция</label>
                        <div class="toggle-group">
                            <input type="radio" id="sum-increase" name="sum-change-type" value="увеличилась" class="calc-trigger"><label for="sum-increase">Увеличение / Доплата</label>
                            <input type="radio" id="sum-decrease" name="sum-change-type" value="уменьшилась" class="calc-trigger" checked><label for="sum-decrease">Уменьшение / Возврат</label>
                        </div>
                    </div>
                    <hr class="hr-line">
                    <div class="form-group">
                        <div class="form-grid">
                            <div class="form-group"><label>Текущая стр. сумма</label><input type="text" class="number-input calc-trigger" id="sum-initial"></div>
                            <div class="form-group"><label>Изменение суммы (Дельта)</label><input type="text" class="number-input calc-trigger" id="sum-delta"></div>
                            <div class="form-group" style="grid-column: 1 / -1;"><label>Новая итоговая стр. сумма</label><input type="text" id="sum-total" readonly></div>
                        </div>
                    </div>
                    <hr class="hr-line">
                    <div class="form-group">
                         <div class="form-grid">
                            <div class="form-group"><label>Текущая премия</label><input type="text" class="number-input calc-trigger" id="premium-initial"></div>
                            <div class="form-group"><label>Изменение премии (Дельта)</label><input type="text" class="number-input calc-trigger" id="premium-delta"></div>
                            <div class="form-group" style="grid-column: 1 / -1;"><label>Новая итоговая премия</label><input type="text" id="premium-total" readonly></div>
                             <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="payment-due-date">Срок доплаты/возврата до:</label>
                                <div class="date-input-group">
                                    <input type="text" class="datepicker-input" id="payment-due-date" placeholder="дд.мм.гггг">
                                    <button class="btn small" type="button" onclick="setCurrentDate('payment-due-date')">Сегодня</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="info-section" class="details-section">
                    <h4>Информационные изменения</h4>
                    <textarea id="info-general-text" rows="5" placeholder="Например: Стороны договорились изменить реквизиты Страхователя..."></textarea>
                </div>
            </fieldset>
        </div>

        <div style="display:flex; justify-content:center; margin-top: 10px;">
            <button class="btn" onclick="generateText()">Сгенерировать текст соглашения</button>
        </div>
    </div>

    <div class="output-column">
        <fieldset id="result-fieldset">
            <legend><svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>Результат</legend>
            <textarea id="result-text" readonly placeholder="Здесь появится сгенерированный текст..."></textarea>
        </fieldset>
    </div>
</div>

<div id="calculationTooltip" class="hidden"></div>

<script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker-full.min.js"></script>
<script src="js/main.js"></script>
</body>
</html>